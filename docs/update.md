# Інструкція з оновлення Telegram-бота

## 1. Підготовка до оновлення

Перед оновленням рекомендується:

Зробити резервну копію бази даних (див. `backup.md`)

Переконатись, що `.env` не змінено або зробити його копію

## 2. Оновлення коду

```
cd telegram-bot-agriculture
git pull origin main
(якщо використовується develop, замінити main на develop)
```

## 3. Оновлення залежностей
```
source venv/bin/activate
pip install -r requirements.txt
```

## 4. Міграції бази даних
Якщо ви додали нові таблиці або змінили структуру бази даних — застосуйте міграції (або вручну оновіть SQL).
### приклад ручної міграції
```
psql -U agro_user -d agro_db -f scripts/migration.sql
```

## 5. Перезапуск сервісу

### якщо використовуєте systemd
```
sudo systemctl restart agro-bot.service
```
### або вручну
````
pkill -f main.py
nohup python main.py &
````

## 6. Перевірка працездатності
Переконайтесь, що бот онлайн

Надішліть /start та переконайтесь у відповіді

Перевірте логи (nohup.out, systemctl status, тощо)

## 7. Типові проблеми та рішення

**1. Помилка:** `ModuleNotFoundError`  
**Причина:** Не встановлено залежності.  
**Рішення:** Виконайте команду:
```
pip install -r requirements.txt
```

**2. Помилка:** `psycopg2.Error` або неможливо підключитися до бази даних  
**Причина:** Неправильні параметри підключення у `.env` файлі або база даних не запущена.  
**Рішення:**  
1. Перевірте, чи правильно заповнені змінні `.env`:
````
DB_HOST=localhost
DB_NAME=agro_db
DB_USER=agro_user
DB_PASSWORD=secure_password
````

2.  Переконайтесь, що PostgreSQL запущено:
````
sudo systemctl status postgresql
````

**3. Проблема:** Бот не реагує на команди  
**Причина:** Бот не запущено, стався збій при запуску або використовується неправильний токен.  
**Рішення:**  
1. Переконайтесь, що бот запущений:
```
ps aux | grep main.py
```
2. Якщо процесу немає — запустіть бот вручну:

````
source venv/bin/activate
nohup python main.py &
````
3. Перевірте логи:

```
cat nohup.out

```

4. Перевірте, чи правильний токен у .env:

```
API_TOKEN=ваш_токен
```

